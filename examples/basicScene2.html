<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="../build/three.js"></script>
    <script src="js/libs/stats.min.js"></script>
    <script src="js/Detector.js"></script>
    <script src="js/controls/OrbitControls.js"></script>
    <script src="js/libs/dat.gui.min.js"></script>

    <style type ="text/css">
        *{   margin: 0;padding: 0;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-size: 12px;
        }
        .wrapperDiv{
            /* overflow:hidden; */
            /* border:1px solid red; */
            height: 100%;
        }
        #sidebar{
            width: 200px;
            float:left;
        }
        .mapview{
            float: left;
            background-color: #fcf8e3;
            border:1px solid grey;
        }

    </style>
</head>
<body>
<div class="wrapperDiv">
    <div id="sidebar" style="position:absolute;">
        <p>고정폭 200px</p>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Porro inventore esse debitis voluptas labore ut quae veritatis reprehenderit ipsum.</p>
    </div>

    <div id="renderView" class="mapview" style="position:absolute;">
    </div>

</div>

<script>

    var scene;
    var camera;
    var renderer;

    var adjustWidth = 204;
    var adjustHeight = 4;

    function initStats(){
        var stats = new Stats();

        stats.setMode(0); // 0: fps, 1: ms

        // Align top-left
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.left = '0px';
        stats.domElement.style.top = '0px';

        document.getElementById("renderView").appendChild(stats.domElement);

        return stats;
    }

    // scene, camera, light 구성
    function InitScene(){

        // scene 생성
        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0xcce0ff );

        // camera 생성
        // camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
        camera = new THREE.PerspectiveCamera( 45, window.window.renderWidth / window.window.renderHeight, 1, 10000 );
        camera.position.x = 1000;
        camera.position.y = 50;
        camera.position.z = 1500;

        scene.add( camera );        // scene에 추가

        //  ambient Light 생성
        var ambientLight = new THREE.AmbientLight( 0x666666 );
        scene.add( ambientLight );

        var dirLight = new THREE.DirectionalLight( 0xdfebff, 1.75 );    // 파라미터 확인할 것
        dirLight.position.set( 50, 200, 100 );
        dirLight.position.multiplyScalar( 1.3 );
        dirLight.castShadow = true;

        dirLight.shadow.mapSize.width = 1024;
        dirLight.shadow.mapSize.height = 1024;

        var dist = 300;
        dirLight.shadow.camera.left = - dist;
        dirLight.shadow.camera.right = dist;
        dirLight.shadow.camera.top = dist;
        dirLight.shadow.camera.bottom = -dist;

        dirLight.shadow.camera.far = 1000;

        scene.add( dirLight );
    }

    function InitMesh(){

        if( scene == null ) {
            console.log( "It's not valid of scene!!");
            return;
        }

        var loader = new THREE.TextureLoader();
        var groundTexture = loader.load( 'textures/terrain/grasslight-big.jpg' );
        groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
        groundTexture.repeat.set( 25, 25 );
        groundTexture.anisotropy = 16;

        var groundMaterial = new THREE.MeshPhongMaterial( { color: 0xffffff, specular: 0x111111, map: groundTexture } );
        var groundMesh = new THREE.Mesh( new THREE.PlaneBufferGeometry( 20000, 20000 ), groundMaterial );
        groundMesh.position.y = - 250;
        groundMesh.rotation.x = - Math.PI / 2;
        groundMesh.receiveShadow = true;
        scene.add( groundMesh );

    }

    function InitRenderer(){
        renderer = new THREE.WebGLRenderer( { antialias : true });
        renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize(window.renderWidth, window.renderHeight );
        renderer.shadowMap.renderSingleSided = false;

        document.getElementById("renderView").appendChild( renderer.domElement );


        // orbit Controls
        var controls = new THREE.OrbitControls( camera, renderer.domElement );
        controls.maxPolarAngle = Math.PI * 0.5;
        controls.minDistance = 1000;
        controls.maxDistance = 7500;
    }


    function RenderLoop(){

        requestAnimationFrame( RenderLoop );

        camera.lookAt( scene.position );
        renderer.render( scene, camera );
    }


    function Init(){

        InitScene();

        InitMesh();

        InitRenderer();
    }


    var adjustScrDiv = (function(){

        var bIsFullScr = 'false';

        function fullScrMap(){
            var sidebar = document.getElementById('sidebar');
            var mapview = document.getElementById('renderView');

            var toggleBtn = document.getElementById("footerToggle");
            toggleBtn.style.left = ( window.innerWidth * 0.5 ) + "px";
            toggleBtn.style.top = (window.innerHeight - 13)+ "px";


            sidebar.style.bottom = 0 + 'px';

            mapview.style.left = 200+'px';
            mapview.style.right = 0 + 'px';
            mapview.style.bottom = 0 + 'px';
        }

        function normalScrMap(){
            var sidebar = document.getElementById('sidebar');
            var mapview = document.getElementById('renderView');
            var footer = document.getElementById('footer');

            var mapHeight = window.innerHeight * 0.65;

            sidebar.style.top = 0;
            sidebar.style.bottom = ( window.innerHeight- ( window.innerHeight * 0.65 )) + 'px';
            mapview.style.left = 200+'px';
            mapview.style.right = 0 + 'px';
            mapview.style.top = 0 + 'px';
            mapview.style.bottom = 0 + 'px';
        }

        function showScrMap( ){

            var img1 = "hideBible.png";
            var img2 = "showBible.png";

            var toggleBtn = document.getElementById("footerToggle");

            if( bIsFullScr == 'false' ) {
                adjustScrDiv.normalScrMap();
                toggleBtn.src = img1;
            }
            else{
                adjustScrDiv.fullScrMap();
                toggleBtn.src = img2;
            }

            map.updateSize();
        }

        function toggleScrMap(){

            if( bIsFullScr == 'false'){
                bIsFullScr = 'true';
            }
            else{
                bIsFullScr = 'false';
            }
            showScrMap();
        }

        return {
            fullScrMap : fullScrMap,
            normalScrMap : normalScrMap,
            showScrMap : showScrMap,
            toggleScrMap : toggleScrMap
        };

    }());

    function toggleScrMap(){
        adjustScrDiv.toggleScrMap();
    }

    window.onload = function(){

        window.renderWidth = window.innerWidth - adjustWidth;
        window.renderHeight = window.innerHeight - adjustHeight;

        /////////
        // window.renderWidth = window.innerWidth;
        // window.renderHeight = window.innerHeight;

        Init();
        RenderLoop();
        adjustScrDiv.normalScrMap();
    };

    window.onresize = function(){

        window.renderWidth = window.innerWidth - adjustWidth;
        window.renderHeight = window.innerHeight - adjustHeight;

        /////////
        // window.renderWidth = window.innerWidth;
        // window.renderHeight = window.innerHeight;

        if( camera ) {
            // camera.aspect = window.innerWidth / window.innerHeight;
            camera.aspect = window.renderWidth / window.renderHeight;
            camera.updateProjectionMatrix();
        }

        if( renderer ) {
            // renderer.setSize(window.innerWidth-adjustWidth, window.innerHeight-adjustHeight);
            renderer.setSize( window.renderWidth, window.renderHeight );
        }

        adjustScrDiv.showScrMap();
    }


</script>

</body>
</html>